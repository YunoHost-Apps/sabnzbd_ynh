#!/bin/bash

source /usr/share/yunohost/helpers

#=================================================
# STOP SYSTEMD SERVICE
#=================================================
ynh_script_progression "Stopping $app's systemd service..."

ynh_systemctl --service=$app --action="stop"

#=================================================
# MODIFY URL IN NGINX CONF
#=================================================
ynh_script_progression "Updating NGINX web server configuration..."

ynh_config_change_url_nginx

#=================================================
# SPECIFIC MODIFICATIONS
#=================================================
# UPDATE SABNZBD CONFIGURATION
#=================================================
ynh_script_progression "Updating SABnzbd configuration..."

# Update url_base in SABnzbd config
if [ -f "$install_dir/config.ini" ]; then
    ynh_replace --match="^url_base = .*" --replace="url_base = $new_path" --file="$data_dir/config.ini"
    ynh_replace --match="^host_whitelist = .*" --replace="host_whitelist = $new_domain" --file="$data_dir/config.ini"
fi

#=================================================

#=================================================
# START SYSTEMD SERVICE
#=================================================
ynh_script_progression "Starting $app's systemd service..."

ynh_systemctl --service=$app --action="start"

#=================================================
# END OF SCRIPT
#=================================================

ynh_script_progression "Change of URL completed for $app"
